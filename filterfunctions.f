      SUBROUTINE FILTERFUNCTIONS (FILTERNAME, NFILT, FLAM, FILT)
C***********************************************************************
C***  Photometric filter functions (JOHNSON, STROEMGREN, etc.)
C***  REFERENCES: Heber et al. (1984: A&A 130, 119)
C***  https://ui.adsabs.harvard.edu/abs/1984A%26A...130..119H/
C***  In this form, newly written by wrh 25-May-2021
C***    but based on previous code that was part of subr. PRIJOST
C***  New filters added: 2MASS J, H, Ks
C***  18.05.21 by Helge: Gaia Gbp, Grp, G ; 
C***                     corrected Ks2MASS #points
C***
C*** Input : FILTERNAME
C*** Output: Vectors of length NFILT (MAXNFILT = 200)
C***              FLAM (wavelength points in Ang)
C***              FILT (filter function at wavelength points) 
C***          The filter functions are *not* yet normalized
C***
C*** Caveat: The wavelength grid is defined here as 
C***             FLAM(I) = FBLUE + I*FINCR
C***             i.e. not with (I-1)*FINCR as one would expect.
C***             This seems to be intentional and correct (wrh 28-May-2021).
C***             Therefore, FBLUE is not the first lambda point FLAM(1),  
C***             but FBLUE = FLAM(1) - FINCR
C***
C*** Called from: WRCONT - PRICOLR - PRIJOST
C***              STEAL  - PRICOLR - PRIJOST
C***              FORMAL - LIMBDARK_OUTPUT 
C***********************************************************************

      IMPLICIT NONE

      REAL UJ(14),BJ(22),VJ(25),US(28),VS(29),BS(29),YS(29)
      REAL J2MASS(194), H2MASS(90), Ks2MASS(90)
      REAL Gaia3Gbp(177), Gaia3Grp(152), Gaia3G(145)

      INTEGER NFILT, I

C***  Filter function: blue start, wavelength increment
      REAL FBLUE, FINCR, FILTMAX

      INTEGER, PARAMETER :: MAXNFILT = 200
      REAL, DIMENSION(MAXNFILT) :: FLAM, FILT
      CHARACTER FILTERNAME*(*)

C***  NAMES OF THE CONSIDERED COLOR BANDS
C***  1 - 3: JOHNSON U,B,V; 
C***  4 - 7: STROEMGREN u,v,b,y; 
C***  8-10: 2MASS J, H, K
C***  11-13: Gaia Gbp, Grp, G


C*** JOHNSON FILTER FUNCTIONS

      DATA UJ/0.000,0.025,0.250,0.680,1.137,1.650,2.006,2.250,2.337,
     -        1.925,0.650,0.197,0.070,0.000/


      DATA BJ/0.000,0.006,0.080,0.337,1.425,2.253,2.806,2.950,3.000,
     -        2.937,2.780,2.520,2.230,1.881,1.550,1.275,0.975,0.695,
     -        0.430,0.210,0.055,0.000/

      DATA VJ/0.020,0.175,0.900,1.880,2.512,2.850,2.820,2.625,2.370,
     -        2.050,1.720,1.413,1.068,0.795,0.567,0.387,0.250,0.160,
     -        0.110,0.081,0.061,0.045,0.028,0.017,0.007/

C***  STROEMGREN FILTER FUNCTIONS

      DATA US/00.00,00.60,05.92,11.80,17.80,23.80,29.12,33.32,36.08,
     -        38.12,39.28,39.44,39.08,38.52,37.08,35.32,33.08,30.08,
     -        26.16,21.68,16.92,11.76,07.68,04.68,02.16,00.88,00.40,
     -        00.00/
      DATA VS/00.00,00.16,00.36,00.84,01.48,02.28,03.04,04.80,07.84,
     -        13.00,20.00,29.88,40.00,47.28,49.32,48.00,43.52,37.20,
     -        28.20,18.12,11.12,06.72,04.00,02.68,02.00,01.40,00.72,
     -        00.36,00.00/
      DATA BS/00.00,00.40,00.96,01.60,02.32,03.60,05.00,08.00,12.40,
     -        20.00,30.20,40.40,45.88,46.88,45.04,38.20,27.84,17.40,
     -        11.00,06.88,03.92,02.52,01.52,01.24,00.92,00.72,00.40,
     -        00.20,00.00/
      DATA YS/00.00,00.68,01.68,02.72,04.00,06.96,10.20,15.20,23.40,
     -        33.00,41.00,45.40,47.92,50.12,52.20,51.32,45.44,34.80,
     -        24.80,15.48,10.00,06.60,04.16,02.52,01.36,00.96,00.80,
     -        00.40,00.00/

C***  2MASS filter functions
      DATA J2MASS 
     >  / 0.01, 0.03, 0.07, 0.12, 0.17, 0.22, 0.29, 0.46, 0.72, 1.06,
     >    1.63, 2.37, 3.10, 4.00, 4.60, 5.12, 5.48, 5.90, 6.41, 6.92,
     >   13.91,26.52,33.48,35.80,37.29,36.78,34.31,26.32,24.66,26.12,
     >   27.93,27.33,26.32,27.71,44.26,38.07,30.16,45.85,32.36,24.99,
     >   47.76,39.56,28.07,27.86,29.52,31.19,29.10,23.27,20.32,34.74,
     >   52.05,61.06,62.19,65.68,69.35,72.59,74.94,78.85,82.18,80.37,
     >   79.51,80.48,82.33,83.67,83.62,80.73,75.45,72.90,70.99,70.19,
     >   69.97,70.14,70.32,70.45,70.36,70.23,70.10,70.69,71.98,73.01,
     >   72.38,71.47,71.54,77.41,83.78,87.42,90.60,92.96,94.49,95.63,
     >   96.38,96.49,95.86,94.72,93.50,92.05,89.34,86.63,82.76,79.19,
     >   77.10,74.91,72.13,69.25,67.30,66.27,65.28,64.56,63.98,63.98,
     >   64.09,64.19,64.34,64.55,64.76,65.54,66.89,68.42,71.06,73.88,
     >   76.06,77.85,80.44,78.86,75.83,74.50,87.53,92.00,86.24,84.83,
     >   85.55,94.71,97.37,92.10,88.14,77.90,40.89,48.88,84.07,79.79,
     >   69.15,59.86,44.99,25.47,12.88, 2.69, 0.40, 1.62, 3.21, 2.82,
     >   0.73, 0.33, 0.21, 0.09, 1.26, 3.18, 1.89, 0.28, 0.03, 0.02,
     >   0.00, 0.00, 0.01, 0.09, 0.25, 0.23, 0.26, 4.44, 5.93, 1.31,
     >   3.13, 2.91, 1.24, 0.17, 0.39, 0.61, 0.78, 0.70, 0.39, 0.11,
     >   0.05, 0.04, 0.03, 0.03, 0.03, 0.03, 0.04, 0.04, 0.04, 0.04,
     >   0.04, 0.03, 0.02, 0.01 /

      DATA H2MASS 
     >  / 0.00, 0.02, 0.03, 0.04, 0.06, 0.10, 0.15, 0.21, 0.26,0.38,
     >    0.55, 0.71, 1.33, 2.74, 6.21,10.79,15.98,22.54,33.06,43.67,
     >   53.37,62.91,71.02,77.02,82.66,87.22,90.52,92.33,92.80,92.41,
     >   88.90,86.32,86.96,89.05,91.02,92.31,91.54,91.26,92.10,92.41,
     >   92.12,92.30,92.39,92.76,93.77,94.55,95.62,97.38,99.29,99.69,
     >   99.86,98.65,96.96,95.46,94.48,93.54,92.73,94.07,96.14,98.00,
     >   98.61,99.00,99.09,98.97,98.71,98.04,96.74,92.44,88.07,82.49,
     >   74.67,65.22,46.83,31.70,39.98,22.79,13.57, 9.72, 6.03, 1.17,
     >    1.60, 0.63, 0.03, 0.00, 0.00, 0.01, 0.01, 0.01, 0.01, 0.00 /

      DATA Ks2MASS 
     > /  0.02, 0.05, 0.24, 0.52, 0.87, 1.30, 2.20, 3.77, 6.48,10.76,
     >   17.06,22.33,20.39,23.14,26.12,29.60,36.93,35.95,44.71,59.87,
     >   69.29,75.65,75.22,72.74,68.95,65.16,64.05,68.44,71.10,72.46,
     >   78.62,81.12,81.97,82.26,84.31,86.60,87.46,86.31,87.93,90.12,
     >   90.96,91.78,92.40,92.68,92.67,92.21,91.29,90.42,91.19,90.83,
     >   86.50,86.43,90.72,94.53,96.32,97.82,98.63,98.48,97.83,97.12,
     >   96.83,98.04,98.25,98.21,97.10,96.87,98.64,97.22,95.79,94.14,
     >   89.55,90.72,80.14,62.72,50.22,41.48,31.24,20.55,14.93,10.36,
     >    7.30, 5.06, 3.68, 2.60, 1.26, 0.87, 0.33, 0.22, 0.26, 0.16 /

C***  Gaia EDR3 filter functions

      DATA Gaia3Gbp
     > /   0.13, 0.80, 2.77, 6.30,10.74,15.39,19.92,23.63,25.19,24.14
     >   ,21.67,18.96,17.88,18.46,20.27,22.31,23.40,23.39,22.85,22.24
     >   ,21.52,20.68,19.69,18.58,17.61,16.77,16.26,16.43,17.30,18.91
     >   ,21.35,24.57,28.15,31.93,35.69,39.22,42.46,45.22,47.67,49.74
     >   ,51.51,53.01,54.33,55.38,56.27,57.05,57.69,58.23,58.73,59.09
     >   ,59.50,59.82,60.12,60.47,60.84,61.11,61.44,61.79,62.12,62.37
     >   ,62.52,62.69,62.74,62.79,62.78,62.71,62.71,62.70,62.69,62.78
     >   ,62.80,62.90,62.99,63.14,63.26,63.42,63.46,63.55,63.50,63.55
     >   ,63.57,63.54,63.46,63.38,63.39,63.31,63.18,63.15,63.11,63.07
     >   ,63.07,63.00,63.03,62.98,63.00,62.96,62.98,62.96,62.83,62.73
     >   ,62.58,62.39,62.28,62.22,62.10,62.01,62.01,62.01,61.97,62.04
     >   ,62.18,62.25,62.26,62.34,62.27,62.15,61.96,61.77,61.58,61.37
     >   ,61.18,60.90,60.65,60.53,60.56,60.81,61.21,61.79,62.54,63.22
     >   ,63.83,64.25,64.30,64.27,64.08,63.60,62.96,62.30,61.68,61.31
     >   ,61.17,61.28,61.57,62.05,62.75,63.58,64.66,65.69,66.32,66.73
     >   ,66.90,66.77,66.42,65.77,64.87,63.80,62.43,60.93,59.28,57.40
     >   ,55.50,53.36,51.13,48.55,45.34,41.17,35.66,28.85,21.34,14.19,
     >     8.35, 4.30, 1.94, 0.78, 0.30, 0.13, 0.09 /

      DATA Gaia3Grp
     > /   0.12, 0.57, 2.45, 9.31,25.12,46.68,64.20,72.62,72.58,68.54
     >   ,68.06,69.02,69.67,69.94,70.31,70.86,71.45,72.14,72.61,73.00
     >   ,73.15,73.20,73.05,72.96,73.03,73.23,73.37,73.56,73.76,73.71
     >   ,73.75,73.56,73.40,73.21,73.11,73.18,73.33,73.71,73.99,74.29
     >   ,74.35,74.37,74.19,73.99,73.89,73.88,73.92,74.02,73.95,73.90
     >   ,73.63,73.19,72.74,72.35,71.84,71.38,70.99,70.64,70.46,70.40
     >   ,70.31,70.38,70.40,70.37,70.24,70.06,69.96,69.52,69.09,68.69
     >   ,68.15,67.64,67.17,66.70,65.92,65.27,64.66,63.76,62.90,62.03
     >   ,61.18,60.15,59.22,58.24,57.09,56.23,55.42,54.40,53.27,52.33
     >   ,51.32,50.41,49.30,48.22,47.14,45.90,44.73,43.55,42.37,41.11
     >   ,39.94,38.70,37.44,36.19,34.92,33.70,32.45,31.15,29.90,28.61
     >   ,27.34,26.10,24.85,23.67,22.43,21.25,20.12,19.02,17.96,16.90
     >   ,15.91,14.95,14.00,13.10,12.15,11.16,10.16, 9.14, 8.16, 7.22,
     >     6.32, 5.48, 4.70, 4.01, 3.40, 2.87, 2.41, 2.01, 1.67, 1.38,
     >     1.14, 0.93, 0.76, 0.61, 0.49, 0.39, 0.31, 0.24, 0.19, 0.15,
     >     0.11, 0.10 /

      DATA Gaia3G
     > /   0.39, 3.13, 7.22,10.42,12.21,12.72,12.40,11.71,11.11,10.85
     >   ,11.20,13.21,17.93,24.77,31.61,37.27,41.78,45.39,48.29,50.62
     >   ,52.56,54.17,55.53,56.73,57.80,58.73,59.57,60.32,61.02,61.65
     >   ,62.26,62.76,63.27,63.72,64.18,64.58,64.99,65.38,65.72,66.12
     >   ,66.42,66.80,67.11,67.38,67.69,67.95,68.23,68.49,68.73,68.92
     >   ,69.18,69.45,69.68,69.86,70.09,70.32,70.50,70.74,70.91,71.08
     >   ,71.19,71.36,71.49,71.57,71.66,71.73,71.75,71.77,71.81,71.77
     >   ,71.67,71.53,71.38,71.23,71.02,70.72,70.39,70.03,69.61,69.08
     >   ,68.58,68.01,67.33,66.58,65.77,64.94,64.05,63.10,62.03,60.94
     >   ,59.76,58.55,57.25,55.97,54.56,53.11,51.60,50.17,48.57,46.98
     >   ,45.35,43.81,42.14,40.49,38.74,37.05,35.40,33.73,32.02,30.42
     >   ,28.76,27.13,25.57,23.98,22.45,20.95,19.52,18.09,16.75,15.43
     >   ,14.17,12.98,11.83,10.75, 9.71, 8.76, 7.84, 6.98, 6.19, 5.45,
     >   4.78, 4.16, 3.60, 3.09, 2.62, 2.21, 1.85, 1.52, 1.25, 1.00,
     >   0.80, 0.63, 0.49, 0.37, 0.27 /

      NFILT = 0

      SELECTCASE (FILTERNAME)

      CASE ('U', 'JOHN U') 
         NFILT = 14
         FBLUE = 2800.
         FINCR = 100.
         FILT(1:NFILT) = UJ
         
      CASE ('B', 'JOHN B') 
         NFILT = 22 
         FBLUE = 3400.
         FINCR = 100.
         FILT(1:NFILT)  = BJ

      CASE ('V', 'JOHN V') 
         NFILT = 25
         FBLUE = 4700.
         FINCR = 100.
         FILT(1:NFILT)  = VJ

      CASE ('u', 'STROEM U') 
         NFILT = 28
         FBLUE = 3125.
         FINCR = 25.
         FILT(1:NFILT)  = US

      CASE ('v', 'STROEM V') 
         FBLUE = 3725.
         FINCR = 25.
         NFILT = 29
         FILT(1:NFILT) = VS

      CASE ('b', 'STROEM B') 
         FBLUE = 4325.
         FINCR = 25.
         NFILT = 29
         FILT(1:NFILT)  = BS

      CASE ('y', 'STROEM Y') 
         NFILT = 29
         FBLUE = 5000.
         FINCR = 25.
         FILT(1:NFILT)  = YS

      CASE ('J_2MASS') 
         NFILT = 194
         FBLUE = 10610.
         FINCR = 20.
         FILT(1:NFILT)  = J2MASS

      CASE ('H_2MASS') 
         NFILT = 90
         FBLUE = 14150.
         FINCR = 50.
         FILT(1:NFILT)  = H2MASS

      CASE ('Ks_2MASS') 
         NFILT = 90
         FBLUE = 19275.
         FINCR = 50.
         FILT(1:NFILT)  = Ks2MASS

      CASE ('Gaia_Gbp') 
         NFILT = 177
C wrong!         FBLUE = 3275.
         FBLUE = 3255.
         FINCR = 20.
         FILT(1:NFILT)  = Gaia3Gbp

      CASE ('Gaia_Grp') 
         NFILT = 152
C wrong!         FBLUE = 6160.
         FBLUE = 6130.
         FINCR = 30.
         FILT(1:NFILT)  = Gaia3Grp

      CASE ('Gaia_G') 
         NFILT = 145
C wrong!         FBLUE = 3280.
         FBLUE = 3230.
         FINCR = 50.
         FILT(1:NFILT)  = Gaia3G

      ENDSELECT

      IF (NFILT .EQ. 0) THEN
         WRITE (0,'(A)') '*** FATAL INTERNAL ERROR:'
         WRITE (0,'(A)') '*** Invalid Filter name: ' // FILTERNAME
         STOP '*** ERROR in subr. FILTERFUNCTIONS'

      ENDIF

C***  WAVELENGTH GRID of selected filter
      DO I=1, NFILT
         FLAM(I) = FBLUE + I * FINCR
      ENDDO

C******** Test Plot Facility
      IF (.FALSE.) THEN 
C*       Normalization: Maximum = 1
         FILTMAX = MAXVAL (FILT(1:NFILT))
         DO I=1, NFILT
           FILT(I) = FILT(I) / FILTMAX
         ENDDO

         CALL PLOTANFS (17, FILTERNAME, FILTERNAME
     >        ,'\CENTER\#l# [\A]'
     >        ,'\CENTER\Transmission'
     >        , .0 , .0 , .0 , .0 , .0 , .0
     >        , .0 , .0 , .0 , .0 , .0 , .0
     >        , FLAM, FILT, NFILT, 'SYMBOL=5 COLOR=2')
      ENDIF

      RETURN
      END
